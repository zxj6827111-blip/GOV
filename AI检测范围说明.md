# GovBudgetChecker AI检测范围详细说明

## 🤖 AI检测的两种模式

### 1. 专项AI检测 (R33110规则)
**检测任务**: `R33110_pairs_v1`
**检测范围**: 预算vs决算一致性检查
**具体内容**:
- 抽取预算数、决算数、说明文字的三元组
- 检查预算与决算数据的一致性
- 分析差异原因的合理性
- 验证说明文字与数据的匹配度

**技术实现**:
- 使用滑窗技术处理长文本
- 窗口大小: 4000字符，重叠: 500字符
- 支持GLM-4.5-Flash、GLM-4.5、DeepSeek-V3.1、DeepSeek-V3四层容灾
- 返回JSON格式的结构化数据

### 2. 全面AI合规检查 (AIFindingsService)
**检测范围**: 9大类合规性检查
1. **九张表齐全性**: 检查预决算表格完整性
2. **目录-正文一致性**: 检查目录与正文对应关系
3. **表内勾稽关系**: 检查总表恒等式和明细汇总
4. **预算vs决算差异**: 检查预算执行合理性
5. **比例和百分比**: 检查各项比例计算准确性
6. **年份和页码**: 检查年份标注和页码连续性
7. **三公经费口径**: 检查三公经费统计一致性
8. **政府采购口径**: 检查政府采购统计规范性
9. **类款项编码**: 检查预算科目编码规范性

**输出格式**: 统一的IssueItem格式
- rule_id: AI-XXX-001格式
- 包含页码、证据、建议等完整信息
- 严重程度分级: critical/high/medium/low/info

## 🔧 AI检测配置

### 环境变量控制
```bash
AI_ASSIST_ENABLED=true          # AI检测总开关
AI_EXTRACTOR_URL=http://127.0.0.1:9009  # AI服务地址
AI_TIMEOUT_SECONDS=60           # AI调用超时时间
AI_MAX_RETRIES=3               # 最大重试次数
```

### AI模型配置 (4层容灾)
1. **主AI**: GLM-4.5-Flash (智谱AI)
2. **备用AI**: GLM-4.5 (ModelScope)
3. **主灾备**: DeepSeek-V3.1
4. **备用灾备**: DeepSeek-V3

## 📊 检测流程

### 1. R33110专项检测
```
用户上传PDF → OCR文本提取 → 规则R33110触发 → 
调用AI抽取器 → 滑窗处理 → AI模型分析 → 
返回三元组数据 → 规则验证 → 生成问题报告
```

### 2. 全面AI检查
```
用户上传PDF → 构建AI提示词 → 包含OCR文本和表格数据 → 
AI模型分析 → 返回JSON格式问题列表 → 
解析为IssueItem → 合并到最终报告
```

## ⚠️ 可能的问题原因

### 1. AI检测未启用
- 检查 `AI_ASSIST_ENABLED` 是否为 `true`
- 检查AI服务是否正常运行在端口9009

### 2. AI模型调用失败
- API密钥配置错误或过期
- 网络连接问题
- 模型服务不可用

### 3. 文档内容问题
- PDF质量太差，OCR识别失败
- 文档内容过于简单，没有可检测的问题
- 文档格式不符合预期

### 4. 前端显示问题
- AI检测结果没有正确传递到前端
- 前端组件没有正确渲染AI检测结果
- 结果格式转换问题

## 🔍 调试建议

### 1. 检查AI服务状态
```bash
curl http://localhost:9009/health
```

### 2. 检查AI检测配置
```bash
curl http://localhost:8000/config
```

### 3. 查看详细日志
- 后端API日志: 检查AI调用是否成功
- AI服务日志: 检查模型调用情况
- 前端控制台: 检查结果显示问题

### 4. 测试AI检测
使用包含明显问题的PDF文件进行测试，如：
- 预算与决算数据不一致
- 表格缺失或不完整
- 计算错误等